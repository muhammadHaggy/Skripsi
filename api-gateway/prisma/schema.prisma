generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id                  Int     @id @default(autoincrement())
  name                String  @unique
  is_allowed_shipment Boolean @default(false)
  is_allowed_do       Boolean @default(false)
  is_allowed_location Boolean @default(false)
  is_allowed_truck    Boolean @default(false)
  is_allowed_user     Boolean @default(false)
  dc_id               Int?
  dc                  DC?     @relation(fields: [dc_id], references: [id])
  User                User[]

  @@map("role")
}

model DC {
  id         Int        @id @default(autoincrement())
  name       String     @unique @db.VarChar(200)
  created_at DateTime   @default(now()) @db.Timestamptz(3)
  created_by String
  updated_at DateTime?  @updatedAt @db.Timestamptz(3)
  updated_by String?
  is_deleted Boolean    @default(false)
  deleted_at DateTime?  @db.Timestamptz(3)
  deleted_by String?
  email      String?
  phone      String?
  mobile     String?
  Location   Location[]
  Truck      Truck[]
  Role       Role[]

  @@map("dc")
}

model User {
  id           String    @id @default(uuid())
  username     String    @db.VarChar(100)
  password     String    @db.VarChar(100)
  first_name   String    @db.VarChar(100)
  last_name    String    @db.VarChar(100)
  phone_num    String?   @db.VarChar(100)
  email        String?   @db.VarChar(100)
  web_token    String?
  mobile_token String?
  is_active    Boolean   @default(true)
  created_at   DateTime  @default(now()) @db.Timestamptz(3)
  updated_at   DateTime? @updatedAt @db.Timestamptz(3)
  is_deleted   Boolean   @default(false)
  deleted_at   DateTime? @db.Timestamptz(3)
  role_id      Int?
  role         Role?     @relation(fields: [role_id], references: [id])

  @@unique([username, email])
  @@map("user")
}

model Customer {
  id         Int        @id @default(autoincrement())
  name       String     @unique @db.VarChar(200)
  created_at DateTime   @default(now()) @db.Timestamptz(3)
  created_by String
  updated_at DateTime?  @updatedAt @db.Timestamptz(3)
  updated_by String?
  is_deleted Boolean    @default(false)
  deleted_at DateTime?  @db.Timestamptz(3)
  deleted_by String?
  email      String?
  phone      String?
  mobile     String?
  npwp       String?
  Location   Location[]

  @@map("customer")
}

model Location {
  id                   String             @id @default(uuid())
  latitude             Float
  longitude            Float
  address              String
  provinsi             String
  kabupaten_kota       String
  kecamatan            String
  desa_kelurahan       String
  kode_pos             Int
  created_at           DateTime           @default(now()) @db.Timestamptz(3)
  created_by           String
  updated_at           DateTime?          @updatedAt @db.Timestamptz(3)
  updated_by           String?
  is_deleted           Boolean            @default(false)
  deleted_at           DateTime?          @db.Timestamptz(3)
  deleted_by           String?
  is_dc                Boolean            @default(false)
  dist_to_origin       Float?             @default(0)
  dist_to_origin_unit  String?
  open_hour            DateTime
  close_hour           DateTime
  service_time         Float              @default(0)
  service_time_unit    String?
  dc_id                Int?
  dc                   DC?                @relation(fields: [dc_id], references: [id])
  customer_id          Int?
  customer             Customer?          @relation(fields: [customer_id], references: [id])
  ShipmentLocation     ShipmentLocation[]
  delivery_order__dest DeliveryOrder[]    @relation("location_dest")
  delivery_order_ori   DeliveryOrder[]    @relation("location_ori")

  @@map("location")
}

model Shipment {
  id                           Int                @id @default(autoincrement())
  total_dist                   Float
  total_dist_unit              String
  total_time                   Float
  total_time_unit              String
  total_volume                 Float
  total_time_with_waiting      Float
  total_time_with_waiting_unit String
  all_coords                   String
  shipment_num                 String             @unique
  status                       ShipmentStatus     @default(READY)
  isSaved                      Boolean            @default(false)
  created_at                   DateTime           @default(now()) @db.Timestamptz(3)
  created_by                   String
  updated_at                   DateTime?          @updatedAt @db.Timestamptz(3)
  updated_by                   String?
  is_deleted                   Boolean            @default(false)
  deleted_at                   DateTime?          @db.Timestamptz(3)
  deleted_by                   String?
  atd                          DateTime?          @db.Timestamptz(3)
  ata                          DateTime?          @db.Timestamptz(3)
  etd                          DateTime?          @db.Timestamptz(3)
  eta                          DateTime?          @db.Timestamptz(3)
  truck_id                     Int?
  shipment_cost                Int?
  truck                        Truck?             @relation(fields: [truck_id], references: [id])
  ShipmentLocation             ShipmentLocation[]
  ShipmentDO                   ShipmentDO[]

  @@map("shipment")
}

model ShipmentLocation {
  shipment_id          Int
  location_id          String
  queue                Int
  eta                  DateTime? @db.Timestamptz(3)
  travel_time          Float
  travel_distance      Float
  travel_time_unit     String
  travel_distance_unit String
  location             Location  @relation(fields: [location_id], references: [id])
  shipment             Shipment  @relation(fields: [shipment_id], references: [id])

  @@id([shipment_id, location_id])
  @@map("shipment_location")
}

model DeliveryOrder {
  id                 Int                 @id @default(autoincrement())
  so_origin          String
  delivery_order_num String              @unique
  description        String?
  volume             Float?
  quantity           Float?
  status             DeliveryOrderStatus @default(READY)
  eta_target         DateTime
  eta                DateTime?           @db.Timestamptz(3)
  etd                DateTime?           @db.Timestamptz(3)
  atd                DateTime?           @db.Timestamptz(3)
  ata                DateTime?           @db.Timestamptz(3)
  order_date         DateTime
  created_at         DateTime            @default(now()) @db.Timestamptz(3)
  created_by         String
  updated_at         DateTime?           @updatedAt @db.Timestamptz(3)
  updated_by         String?
  is_deleted         Boolean             @default(false)
  deleted_at         DateTime?           @db.Timestamptz(3)
  deleted_by         String?
  loc_dest_id        String?
  loc_ori_id         String?
  truck_id           Int?
  loc_dest           Location?           @relation("location_dest", fields: [loc_dest_id], references: [id])
  loc_ori            Location?           @relation("location_ori", fields: [loc_ori_id], references: [id])
  truck              Truck?              @relation(fields: [truck_id], references: [id])
  ShipmentDO         ShipmentDO[]
  ProductLine        ProductLine[]
  BoxDO              BoxDO[]

  @@map("delivery_order")
}

model Box {
  id         String    @id
  dgx_id     Int       @default(0)
  name       String    @unique
  volume     Float?
  height     Float     @default(0.0)
  width      Float     @default(0.0)
  length     Float     @default(0.0)
  pcUrl      String?
  scanned_at DateTime  @default(now()) @db.Timestamptz(3)
  deleted_at DateTime? @db.Timestamptz(3)
  deleted_by String?
  BoxDO      BoxDO[]
  status     String    @default("created")

  @@map("box")
}

model BoxDO {
  box_id            String
  delivery_order_id Int
  delivery_order    DeliveryOrder @relation(fields: [delivery_order_id], references: [id])
  box               Box           @relation(fields: [box_id], references: [id])
  quantity          Int           @default(1)

  @@id([box_id, delivery_order_id])
  @@map("box_delivery_order")
}

model ShipmentDO {
  shipment_id       Int
  delivery_order_id Int
  delivery_order    DeliveryOrder @relation(fields: [delivery_order_id], references: [id])
  shipment          Shipment      @relation(fields: [shipment_id], references: [id])

  @@id([shipment_id, delivery_order_id])
  @@map("shipment_delivery_order")
}

model Product {
  id               Int           @id @default(autoincrement())
  name             String        @unique
  description      String?
  product_category String
  product_type     String
  ProductLine      ProductLine[]

  @@map("product")
}

model ProductLine {
  delivery_order_id Int
  product_id        Int
  volume            Float
  weight            Float
  price             Float
  quantity          Float
  unit_volume       String
  unit_price        String
  unit_weight       String
  unit_quantity     String
  delivery_order    DeliveryOrder @relation(fields: [delivery_order_id], references: [id])
  product           Product       @relation(fields: [product_id], references: [id])

  @@id([delivery_order_id, product_id])
  @@map("product_line")
}

model Truck {
  id                             Int                @id @default(autoincrement())
  plate_number                   String             @unique @db.VarChar(100)
  first_status                   TruckFirstStatus   @default(AVAILABLE)
  second_status                  TruckSecondStatus?
  max_individual_capacity_volume Float?
  created_at                     DateTime           @default(now()) @db.Timestamptz(3)
  created_by                     String
  updated_at                     DateTime?          @updatedAt @db.Timestamptz(3)
  updated_by                     String?
  fuel_consumption_liters_per_km String?
  type_id                        Int?
  dc_id                          Int?
  dc                             DC?                @relation(fields: [dc_id], references: [id])
  truck_type                     TruckType?         @relation(fields: [type_id], references: [id])
  Shipment                       Shipment[]
  DeliveryOrder                  DeliveryOrder[]
  truck_cost                     TruckCost[]

  @@map("truck")
}

model TruckType {
  id     Int     @id @default(autoincrement())
  name   String  @unique
  Truck  Truck[]
  length Int     @default(0)
  width  Int     @default(0)
  height Int     @default(0)

  @@map("truck_type")
}

model TruckCost {
  truck_id Int
  cost_id  Int
  Cost     Cost  @relation(fields: [cost_id], references: [id])
  Truck    Truck @relation(fields: [truck_id], references: [id])

  @@id([truck_id, cost_id])
  @@map("truck_cost")
}

model Cost {
  id         Int         @id @default(autoincrement())
  cost_name  String
  cost_value Float
  TruckCost  TruckCost[]

  @@map("cost")
}

enum TruckFirstStatus {
  AVAILABLE
  UNAVAILABLE
}

enum TruckSecondStatus {
  ON_DELIVERY
  OUT_OF_STOCK
  ARCHIVE
  MAINTENANCE
  LEGAL
}

enum DeliveryOrderStatus {
  READY
  RUNNING
  PENDING
  DONE
  IN_CALCULATION
}

enum ShipmentStatus {
  READY
  RUNNING
  CANCELLED
  DONE
  DRAF
}
